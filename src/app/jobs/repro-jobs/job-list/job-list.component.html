<button appFileDrop #fileDrop="appFileDrop" mat-fab (filesEmitter)="onFileDrop($event)" [matMenuTriggerFor]="newJobMenu"
    color="primary" class="plus-button mat-elevation-z8">
    <mat-icon *ngIf="!fileDrop.dragOver">
        add
    </mat-icon>
</button>

<mat-menu #newJobMenu="matMenu">
    <a mat-menu-item routerLink="/jobs/repro/new">
        <mat-icon>
            note_add
        </mat-icon>
        <span>
            Jauns darbs
        </span>
    </a>
    <button mat-menu-item (click)="uploadFile.click()">
        <mat-icon>
            upload_file
        </mat-icon>
        <span>
            Augšuplādēt failu
        </span>
    </button>
</mat-menu>

<input type="file" hidden multiple #uploadFile (change)="onFileSelected($event)">


<cdk-virtual-scroll-viewport itemSize="32" class="container" scroll-to-top>


    <table class="simple-form-table">
        <thead>
            <tr>
                <th class="column-state"></th>
                <th class="column-jobId">ID</th>
                <th class="column-customer">Kl.</th>
                <th class="column-date">Datums</th>
                <th class="column-name">Nosaukums</th>
                <ng-container *ngIf="isLarge$ | async">
                    <th class="column-productsObj-name">Izstrādājums</th>
                    <th class="column-productsObj-count">Skaits</th>
                    <th class="column-productsObj-units"></th>
                </ng-container>
            </tr>
        </thead>
        <tbody>
            <tr *cdkVirtualFor="let job of dataSource$; let idx=index;" [class.job-completed]="job.invoiceId"
                [routerLink]="[job.jobId]" [class.highlited]="hasProduct(job, highlited)">
                <!-- statusa indikators -->
                <td class="column-state">
                    <mat-icon *ngIf="job.jobStatus.generalStatus === 20" color="primary">
                        label_important
                    </mat-icon>
                </td>
                <!-- jobId -->
                <td class="column-jobId">
                    {{job.jobId}}
                </td>

                <!-- customer -->
                <td class="column-customer">
                    {{job.custCode}}
                </td>

                <!-- 'receivedDate' -->
                <td class="column-date">
                    {{job.dueDate | date:'dd.MM.yyyy'}}
                </td>

                <!-- 'name' -->
                <td class="column-name">
                    <div>
                        <span class="name" [matTooltip]="job.name" [matTooltipShowDelay]="500"
                            [matTooltipDisabled]="job.name.length < 50">
                            {{job.name}}
                        </span>
                        <span class="buttons">
                            <button mat-icon-button (click)="copyJobIdAndName(job, $event);"
                                matTooltip="Kopēt nosaukumu">
                                <mat-icon>filter_none</mat-icon>
                            </button>
                            <button *ngIf="job.jobStatus.generalStatus === 20" mat-icon-button
                                matToolTip="Atzīmēt pabeigtu"
                                (click)="$event.stopPropagation(); onSetJobStatus(job.jobId, 30)">
                                <mat-icon>check</mat-icon>
                            </button>
                            <button *ngIf="job.jobStatus.generalStatus === 10" mat-icon-button color="primary"
                                matToolTip="Darbs aktīvs"
                                (click)="$event.stopPropagation(); onSetJobStatus(job.jobId, 20)">
                                <mat-icon>label_important</mat-icon>
                            </button>
                        </span>
                    </div>
                </td>

                <ng-container *ngIf="isLarge$ | async">
                    <!-- Izstrādājums -->
                    <td class="column-productsObj-name" [colSpan]="job.products?.length === 1 ? 0 : 3">
                        <span *ngFor="let product of job.products; last as last;"
                            [class.highlited-product]="product.name === highlited">
                            {{ product.name }}{{last? '' : ','}}
                        </span>
                        <!-- {{job.productsObj?.name}} -->
                    </td>
                    <!-- Skaits -->
                    <td *ngIf="job.products?.length === 1" class="column-productsObj-count">
                        {{job.products[0].count}}
                    </td>
                    <!-- Mērvienības! -->
                    <td *ngIf="job.products?.length === 1" class="column-productsObj-units">
                        {{ job.products[0].units }}
                    </td>
                </ng-container>

            </tr>
        </tbody>

    </table>
</cdk-virtual-scroll-viewport>