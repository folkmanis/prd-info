<app-simple-form-typed-container>

    <!-- Nosaukums nelabojams -->
    <span *ngIf="!isNew;" appSimpleFormLabel>
        {{form.controls.name.value}}
    </span>

    <form [formGroup]="form">
        <!-- Nosaukums labojams -->
        <h2 *ngIf="isNew;">
            <mat-form-field>
                <mat-label>Nosaukums</mat-label>
                <input matInput formControlName="name" required>
                <mat-error *ngIf="form.controls.name.hasError('required')">
                    Jānorāda obligāti
                </mat-error>
                <mat-error *ngIf="form.controls.name.hasError('occupied')">
                    Nosaukums {{form.controls.name.getError('occupied')}} jau aizņemts!
                </mat-error>
            </mat-form-field>
        </h2>

        <mat-accordion multi>
            <mat-expansion-panel expanded [hideToggle]="true">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Pamatinformācija
                    </mat-panel-title>
                </mat-expansion-panel-header>


                <!-- Kategorija -->
                <section>
                    <mat-form-field>
                        <mat-label>Kategorija</mat-label>
                        <mat-select formControlName="category" required>
                            <mat-option *ngFor="let category of categories$ | async" [value]="category.category">
                                {{category.description}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </section>
                <!-- Mērvienības -->
                <section>
                    <mat-form-field>
                        <mat-label>Mērvienības</mat-label>
                        <mat-select formControlName="units" required>
                            <mat-option *ngFor="let unit of units$ | async" [value]="unit.shortName">
                                {{unit.shortName}} ({{unit.description}})
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </section>
                <!-- Neaktīvs -->
                <section>
                    <mat-checkbox formControlName="inactive">
                        Neaktīvs
                    </mat-checkbox>
                </section>
                <!-- Apraksts -->
                <section>
                    <mat-form-field>
                        <mat-label>Papildus apraksts</mat-label>
                        <textarea matInput matAutosize formControlName="description"></textarea>
                    </mat-form-field>
                </section>
            </mat-expansion-panel>

            <!-- Paytraq -->
            <mat-expansion-panel #paytraqPanel [disabled]="paytraqDisabled$ | async">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Paytraq savienojums
                    </mat-panel-title>
                    <mat-panel-description *ngIf="form.value.paytraqId as id;">
                        {{ id }}
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <app-paytraq-product formControlName="paytraqId" [productName]="form.value.name">
                </app-paytraq-product>

            </mat-expansion-panel>

            <!-- <mat-expansion-panel expanded> -->
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Pārdošanas cenas
                    </mat-panel-title>
                </mat-expansion-panel-header>

                <!-- Cenu tabula -->
                <section>
                    <app-product-prices formControlName="prices" [customers]="customers$ | async" #prices>
                    </app-product-prices>
                </section>

                <mat-action-row>
                    <button mat-mini-fab (click)="prices.addPrice()" [disabled]="form.invalid" color="primary">
                        <mat-icon>
                            add
                        </mat-icon>
                    </button>
                </mat-action-row>

            </mat-expansion-panel>

            <mat-expansion-panel expanded>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Ražošanas procesi
                    </mat-panel-title>
                </mat-expansion-panel-header>

                <!-- Ražošanas procesu tabula -->
                <section>
                    <app-product-production-stages #prodStages formControlName="productionStages">
                    </app-product-production-stages>
                </section>

                <mat-action-row>
                    <button mat-mini-fab color="primary" (click)="prodStages.onNewProductionStage();">
                        <mat-icon> add </mat-icon>
                    </button>
                </mat-action-row>

            </mat-expansion-panel>

        </mat-accordion>


    </form>

</app-simple-form-typed-container>