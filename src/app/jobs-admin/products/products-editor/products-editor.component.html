<app-simple-form-container [formSource]="formSource" (dataChange)="onDataChange($event)">

    <form [formGroup]="form">
        <!-- Nosaukums labojams -->
        <h2 *ngIf="isNew; else existingProduct">
            <mat-form-field>
                <mat-label>Nosaukums</mat-label>
                <input matInput formControlName="name" required>
                <mat-error *ngIf="form.controls.name.hasError('required')">
                    Jānorāda obligāti
                </mat-error>
                <mat-error *ngIf="form.controls.name.hasError('occupied')">
                    Nosaukums {{form.controls.name.getError('occupied')}} jau aizņemts!
                </mat-error>
            </mat-form-field>
        </h2>
        <!-- Nosaukums nelabojams -->
        <ng-template #existingProduct>
            <h2>
                {{form.controls.name.value}}
            </h2>
        </ng-template>

        <mat-accordion multi>
            <mat-expansion-panel expanded [hideToggle]="true">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Pamatinformācija
                    </mat-panel-title>
                </mat-expansion-panel-header>


                <!-- Kategorija -->
                <section>
                    <mat-form-field>
                        <mat-label>Kategorija</mat-label>
                        <mat-select formControlName="category" required>
                            <mat-option *ngFor="let category of categories$ | async" [value]="category.category">
                                {{category.description}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </section>
                <!-- Mērvienības -->
                <section>
                    <mat-form-field>
                        <mat-label>Mērvienības</mat-label>
                        <mat-select formControlName="units" required>
                            <mat-option *ngFor="let unit of units$ | async" [value]="unit.shortName">
                                {{unit.shortName}} ({{unit.description}})
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </section>
                <!-- Neaktīvs -->
                <section>
                    <mat-checkbox formControlName="inactive">
                        Neaktīvs
                    </mat-checkbox>
                </section>
                <!-- Apraksts -->
                <section>
                    <mat-form-field>
                        <mat-label>Papildus apraksts</mat-label>
                        <textarea matInput matAutosize formControlName="description"></textarea>
                    </mat-form-field>
                </section>
            </mat-expansion-panel>

            <!-- Paytraq -->
            <mat-expansion-panel #paytraqPanel [disabled]="paytraqDisabled$ | async">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Paytraq savienojums
                    </mat-panel-title>
                    <mat-panel-description *ngIf="form.value.paytraqId as id;">
                        {{ id }}
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <app-paytraq-product formControlName="paytraqId" [product]="form.value">
                </app-paytraq-product>

            </mat-expansion-panel>

            <mat-expansion-panel expanded>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Cenas
                    </mat-panel-title>
                </mat-expansion-panel-header>

                <!-- Cenu tabula -->
                <section>
                    <app-product-prices formGroupName="prices" [customers]="customers$ | async"
                        (addPrice)="onAddPrice(form.controls.prices)"
                        (removePrice)="onDeletePrice(form.controls.prices, $event)">
                    </app-product-prices>
                </section>

            </mat-expansion-panel>

        </mat-accordion>


    </form>

</app-simple-form-container>